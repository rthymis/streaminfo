<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streaminfo Front-end Test</title>
    <style>
        #mndbng-history {
            list-style-type: none;
            margin: 0;
            padding: 0;
        }

        #mndbng-history li {
            margin-bottom: 10px;
        }

        #mndbng-track-container,
        #mndbng-history-container  {
            margin-bottom: 20px;
            margin-left: 20px;
            font-size: 20px
        }

        .mndbng-track-time {
            font-size: 15px;
            font-weight: bold;
            color: #718093;
        }

        .mndbng-track-title {
            color: #ff7675;
        }

        .mndbng-track-label {
            color: #718093
        }

        body {
            font-family: Arial;
            background-color: black;
            color: white;
        }
    </style>
</head>

<body>
    <div id="mndbng-track-container">
        <div>
            <span class="mndbng-track-label">Artist: </span>
            <span id="mndbng-track-artist-container">Loading...</span>
        </div>
        <div>
            <span class="mndbng-track-label">Title: </span>
            <span id="mndbng-track-title-container">Loading...</span>
        </div>   
    </div>
    
    <div id="mndbng-history-container">Loading...</div>
</body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdn.socket.io/4.4.1/socket.io.min.js" integrity="sha384-fKnu0iswBIqkjxrhQCTZ7qlLHOFEgNkRmK2vaO/LbTZSXdJfAu6ewRBdwHPhBo/H" crossorigin="anonymous"></script>

<script>

    // const socket = io('http://localhost:80/');
    const socket = io('wss://streaminfo.naquema.com/');

    // Actions that happen when the initial message (msg) is received from the server
    socket.on('streaminfoinitial', function(msg) {
        
        // Incoming values for track artist, title, time
        var incomingFirstTrackArtist = msg[0].artist;
        var incomingFirstTrackTitle = msg[0].title;
        
        // Current values for track artist, title
        var currentFirstTrackArtist = $('.mndbng-track-artist:eq(0)').html();
        var currentFirstTrackTitle = $('.mndbng-track-title:eq(0)').html();
        
        // Check first if the incoming track is already received and rendered by comparing the incoming track artist and title with the current track artist and title
        if (currentFirstTrackArtist !== incomingFirstTrackArtist && currentFirstTrackTitle !== incomingFirstTrackTitle) {
            // Initial Track
            trackArtistContainer = $('#mndbng-track-artist-container');
            trackTitleContainer = $('#mndbng-track-title-container');
            trackArtistContainer.fadeOut(500, function() {
                trackArtistContainer.text(incomingFirstTrackArtist).fadeIn(1000) 
            });
            trackTitleContainer.fadeOut(500, function() {
                trackTitleContainer.text(incomingFirstTrackTitle).fadeIn(1000) 
            });

            // Initial History
            var html = "<ul id='mndbng-history'>";
            var isFirst = true;
            // Create the HTML list that will be rendered
            $.each(msg, function (index, item) {
                var time = item.time;
                // For the first track we set the time to 'NOW ON AIR'
                if (isFirst) {
                    time = 'NOW ON AIR';
                    isFirst = false;
                } else {
                    // We remove the last 3 characters (the seconds) from the track time
                    time = time.slice(0, -3);
                }
                html += "<li><div class='mndbng-track-time'>" + time + "</div><div class='mndbng-track-artist'>" + item.artist + "</div><div class='mndbng-track-title'>" + item.title + "</div></li>";
            });
            html+="</ul>";
            // Render the HTML list
            historyContainer = $('#mndbng-history-container');
            historyContainer.fadeOut(500, function() {
                historyContainer.html(html).fadeIn(1000) 
            });
            console.log('first');
        }

    });

    // Actions that happen when the messages after the initial message (msg) are received from the server
    socket.on('streaminfo', function(msg) {
        
        // Incoming values for track artist, title, time
        var incomingFirstTrackTime = msg[0].time;
        var incomingFirstTrackArtist = msg[0].artist;
        var incomingFirstTrackTitle = msg[0].title;

        // Current values for track artist, title
        var currentFirstTrackArtist = $('.mndbng-track-artist:eq(0)').html();
        var currentFirstTrackTitle = $('.mndbng-track-title:eq(0)').html();
        
        // Check first if the incoming track is already received and rendered by comparing the incoming track artist and title with the current track artist and title
        if (currentFirstTrackArtist !== incomingFirstTrackArtist && currentFirstTrackTitle !== incomingFirstTrackTitle) {
            // After initial history
            // Add the new track to the top of the list and remove the last track
            // We remove the last 3 characters (the seconds) from the track time
            var li = "<li><div id='mndbng-track-visibility' style='visibility: hidden'><div class='mndbng-track-time'>" + incomingFirstTrackTime.slice(0, -3) + "</div><div class='mndbng-track-artist'>" + incomingFirstTrackArtist + "</div><div class='mndbng-track-title'>" + incomingFirstTrackTitle + "</div></div></li>";

            $(li).hide().prependTo('#mndbng-history').hide().slideDown(1000, function(){
                $('#mndbng-track-visibility').css('visibility','visible').hide().fadeIn(1000);
            });
            $('#mndbng-history').children().last().fadeOut(1000, function() {
                $(this).remove();
            });
            
            // Set the time of the first track to 'NOW ON AIR' and the time of the second track to it's actual track time
            // We remove the last 3 characters (the seconds) from the track time
            // $('.mndbng-track-time:eq(0)').html("NOW ON AIR").fadeIn(1000);
            // $('.mndbng-track-time:eq(1)').html(msg[1].time.slice(0, -3)).fadeIn(1000);
            $('.mndbng-track-time:eq(0)').fadeOut(500, function() {
                $(this).html("NOW ON AIR").fadeIn(1000);
            });
            $('.mndbng-track-time:eq(1)').fadeOut(500, function() {
                $(this).html(msg[1].time.slice(0, -3)).fadeIn(1000);
            });

            // After initial track
            trackArtistContainer = $('#mndbng-track-artist-container');
            trackTitleContainer = $('#mndbng-track-title-container');
            trackArtistContainer.fadeOut(500, function() {
                trackArtistContainer.text(incomingFirstTrackArtist).fadeIn(1000) 
            });
            trackTitleContainer.fadeOut(500, function() {
                trackTitleContainer.text(incomingFirstTrackTitle).fadeIn(1000) 
            });
            console.log('second');
        } 

    });  

</script>

</html>



